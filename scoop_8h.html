<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>librsync: scoop.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <!-- ad -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- librsync -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3547096055927362"
         data-ad-slot="8322976738"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">librsync
   &#160;<span id="projectnumber">2.3.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">scoop.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Manage librsync streams of IO.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
Include dependency graph for scoop.h:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="scoop_8h__incl.svg" width="1002" height="336"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="scoop_8h__dep__incl.svg" width="755" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="scoop_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5285265e3d220e43b8fd08867d708d9c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#a5285265e3d220e43b8fd08867d708d9c">rs_tube_catchup</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="memdesc:a5285265e3d220e43b8fd08867d708d9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Put whatever will fit from the tube into the output of the stream.  <a href="scoop_8h.html#a5285265e3d220e43b8fd08867d708d9c">More...</a><br /></td></tr>
<tr class="separator:a5285265e3d220e43b8fd08867d708d9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa78a2f17f45a022ec0f93a50c3f142d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#afa78a2f17f45a022ec0f93a50c3f142d">rs_tube_is_idle</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> const *job)</td></tr>
<tr class="separator:afa78a2f17f45a022ec0f93a50c3f142d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98f3b8fcc410948351d62728018ec67d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#a98f3b8fcc410948351d62728018ec67d">rs_tube_write</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, void const *buf, size_t len)</td></tr>
<tr class="memdesc:a98f3b8fcc410948351d62728018ec67d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push some data into the tube for storage.  <a href="scoop_8h.html#a98f3b8fcc410948351d62728018ec67d">More...</a><br /></td></tr>
<tr class="separator:a98f3b8fcc410948351d62728018ec67d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1170d5552b5581630f90d8a66a71adc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#aa1170d5552b5581630f90d8a66a71adc">rs_tube_copy</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t len)</td></tr>
<tr class="memdesc:aa1170d5552b5581630f90d8a66a71adc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue up a request to copy through <code>len</code> bytes from the input to the output of the stream.  <a href="scoop_8h.html#aa1170d5552b5581630f90d8a66a71adc">More...</a><br /></td></tr>
<tr class="separator:aa1170d5552b5581630f90d8a66a71adc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad3e63ccd707266363d6feeca754a370"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#aad3e63ccd707266363d6feeca754a370">rs_scoop_advance</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t len)</td></tr>
<tr class="memdesc:aad3e63ccd707266363d6feeca754a370"><td class="mdescLeft">&#160;</td><td class="mdescRight">Advance the input cursor forward <code>len</code> bytes.  <a href="scoop_8h.html#aad3e63ccd707266363d6feeca754a370">More...</a><br /></td></tr>
<tr class="separator:aad3e63ccd707266363d6feeca754a370"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a026b9505478d48f4b9b05fea46c166e1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#a026b9505478d48f4b9b05fea46c166e1">rs_scoop_readahead</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t len, void **ptr)</td></tr>
<tr class="memdesc:a026b9505478d48f4b9b05fea46c166e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read from scoop without advancing.  <a href="scoop_8h.html#a026b9505478d48f4b9b05fea46c166e1">More...</a><br /></td></tr>
<tr class="separator:a026b9505478d48f4b9b05fea46c166e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9eb894edc12cd2972a1eb020bdc80725"><td class="memItemLeft" align="right" valign="top"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#a9eb894edc12cd2972a1eb020bdc80725">rs_scoop_read</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t len, void **ptr)</td></tr>
<tr class="memdesc:a9eb894edc12cd2972a1eb020bdc80725"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read LEN bytes if possible, and remove them from the input scoop.  <a href="scoop_8h.html#a9eb894edc12cd2972a1eb020bdc80725">More...</a><br /></td></tr>
<tr class="separator:a9eb894edc12cd2972a1eb020bdc80725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9c1b8a80bbed23d9409559fa101496b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#af9c1b8a80bbed23d9409559fa101496b">rs_scoop_read_rest</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t *len, void **ptr)</td></tr>
<tr class="memdesc:af9c1b8a80bbed23d9409559fa101496b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read whatever data remains in the input stream.  <a href="scoop_8h.html#af9c1b8a80bbed23d9409559fa101496b">More...</a><br /></td></tr>
<tr class="separator:af9c1b8a80bbed23d9409559fa101496b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28ab45a981e0a32d504f9eb3c6155798"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#a28ab45a981e0a32d504f9eb3c6155798">rs_scoop_avail</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="separator:a28ab45a981e0a32d504f9eb3c6155798"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6eb10b8ed1aa7f16ddf66e2e1051ff85"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#a6eb10b8ed1aa7f16ddf66e2e1051ff85">rs_scoop_eof</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="memdesc:a6eb10b8ed1aa7f16ddf66e2e1051ff85"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test if the scoop has reached eof.  <a href="scoop_8h.html#a6eb10b8ed1aa7f16ddf66e2e1051ff85">More...</a><br /></td></tr>
<tr class="separator:a6eb10b8ed1aa7f16ddf66e2e1051ff85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac67ce8e051fbfa5b65cbaf09f42a5b15"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#ac67ce8e051fbfa5b65cbaf09f42a5b15">rs_scoop_buf</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="memdesc:ac67ce8e051fbfa5b65cbaf09f42a5b15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a pointer to the next input in the scoop.  <a href="scoop_8h.html#ac67ce8e051fbfa5b65cbaf09f42a5b15">More...</a><br /></td></tr>
<tr class="separator:ac67ce8e051fbfa5b65cbaf09f42a5b15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee362de570b50eb6b6c4e9d8f0251208"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#aee362de570b50eb6b6c4e9d8f0251208">rs_scoop_len</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="memdesc:aee362de570b50eb6b6c4e9d8f0251208"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the contiguous length of the next input in the scoop.  <a href="scoop_8h.html#aee362de570b50eb6b6c4e9d8f0251208">More...</a><br /></td></tr>
<tr class="separator:aee362de570b50eb6b6c4e9d8f0251208"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e7de2ad29ba6881e1320c5f45e7b023"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#a0e7de2ad29ba6881e1320c5f45e7b023">rs_scoop_getbuf</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t *len)</td></tr>
<tr class="memdesc:a0e7de2ad29ba6881e1320c5f45e7b023"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the next contiguous buffer of data available in the scoop.  <a href="scoop_8h.html#a0e7de2ad29ba6881e1320c5f45e7b023">More...</a><br /></td></tr>
<tr class="separator:a0e7de2ad29ba6881e1320c5f45e7b023"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0599c9d3737912cd1fc5e31bc8664c1"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#ab0599c9d3737912cd1fc5e31bc8664c1">rs_scoop_iterbuf</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t *len, size_t *ilen)</td></tr>
<tr class="memdesc:ab0599c9d3737912cd1fc5e31bc8664c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Iterate through and consume contiguous data buffers in the scoop.  <a href="scoop_8h.html#ab0599c9d3737912cd1fc5e31bc8664c1">More...</a><br /></td></tr>
<tr class="separator:ab0599c9d3737912cd1fc5e31bc8664c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeee826905a895126adac975f2c3cfc78"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8h.html#aeee826905a895126adac975f2c3cfc78">rs_scoop_nextbuf</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t *len, size_t *ilen)</td></tr>
<tr class="memdesc:aeee826905a895126adac975f2c3cfc78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the next iteration of contiguous data buffers from the scoop.  <a href="scoop_8h.html#aeee826905a895126adac975f2c3cfc78">More...</a><br /></td></tr>
<tr class="separator:aeee826905a895126adac975f2c3cfc78"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Manage librsync streams of IO. </p>
<p >See </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="scoop_8c.html" title="This file deals with readahead from caller-supplied buffers.">scoop.c</a> and </dd>
<dd>
<a class="el" href="tube_8c.html" title="A somewhat elastic but fairly small buffer for data passing through a stream.">tube.c</a> for related code for input and output respectively.</dd></dl>
<p>OK, so I'll admit IO here is a little complex. The most important player here is the stream, which is an object for managing filter operations. It has both input and output sides, both of which is just a (pointer,len) pair into a buffer provided by the client. The code controlling the stream handles however much data it wants, and the client provides or accepts however much is convenient.</p>
<p >At the same time as being friendly to the client, we also try to be very friendly to the internal code. It wants to be able to ask for arbitrary amounts of input or output and get it without having to keep track of partial completion. So there are functions which either complete, or queue whatever was not sent and return RS_BLOCKED.</p>
<p >The output buffer is a little more clever than simply a data buffer. Instead it knows that we can send either literal data, or data copied through from the input of the stream.</p>
<p >In <a class="el" href="buf_8c_source.html">buf.c</a> you will find functions that then map buffers onto stdio files.</p>
<p >On return from an encoding function, some input will have been consumed and/or some output produced, but either the input or the output or possibly both could have some remaining bytes available.</p>
<p >librsync never does IO or memory allocation for stream input, but relies on the caller. This is very nice for integration, but means that we have to be fairly flexible as to when we can &lsquo;read&rsquo; or &lsquo;write&rsquo; stuff internally.</p>
<p >librsync basically does two types of IO. It reads network integers of various lengths which encode command and control information such as versions and signatures. It also does bulk data transfer.</p>
<p >IO of network integers is internally buffered, because higher levels of the code need to see them transmitted atomically: it's no good to read half of a uint32. So there is a small and fixed length internal buffer which accumulates these. Unlike previous versions of the library, we don't require that the caller hold the start until the whole thing has arrived, which guarantees that we can always make progress.</p>
<p >On each call into a stream iterator, it should begin by trying to flush output. This may well use up all the remaining stream space, in which case nothing else can be done. </p>

<p class="definition">Definition in file <a class="el" href="scoop_8h_source.html">scoop.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a5285265e3d220e43b8fd08867d708d9c" name="a5285265e3d220e43b8fd08867d708d9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5285265e3d220e43b8fd08867d708d9c">&#9670;&nbsp;</a></span>rs_tube_catchup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a> rs_tube_catchup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Put whatever will fit from the tube into the output of the stream. </p>
<dl class="section return"><dt>Returns</dt><dd>RS_DONE if the tube is now empty and ready to accept another command, RS_BLOCKED if there is still stuff waiting to go out. </dd></dl>

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00120">120</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
<a id="afa78a2f17f45a022ec0f93a50c3f142d" name="afa78a2f17f45a022ec0f93a50c3f142d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa78a2f17f45a022ec0f93a50c3f142d">&#9670;&nbsp;</a></span>rs_tube_is_idle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rs_tube_is_idle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> const *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00144">144</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
<a id="a98f3b8fcc410948351d62728018ec67d" name="a98f3b8fcc410948351d62728018ec67d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98f3b8fcc410948351d62728018ec67d">&#9670;&nbsp;</a></span>rs_tube_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rs_tube_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Push some data into the tube for storage. </p>
<p >The tube's never supposed to get very big, so this will just pop loudly if you do that.</p>
<p >We can't accept write data if there's already a copy command in the tube, because the write data comes out first. </p>

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00174">174</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
<a id="aa1170d5552b5581630f90d8a66a71adc" name="aa1170d5552b5581630f90d8a66a71adc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1170d5552b5581630f90d8a66a71adc">&#9670;&nbsp;</a></span>rs_tube_copy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rs_tube_copy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue up a request to copy through <code>len</code> bytes from the input to the output of the stream. </p>
<p >The data is copied from the scoop (if there is anything there) or from the input, on the next call to <a class="el" href="tube_8c.html#a15809106e8f91386fb19f3934f73b993" title="Push some data into the tube for storage.">rs_tube_write()</a>.</p>
<p >We can only accept this request if there is no copy command already pending.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000020">Todo:</a></b></dt><dd>Try to do the copy immediately, and return a result. Then, people can try to continue if possible. Is this really required? Callers can just go out and back in again after flushing the tube. </dd></dl>

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00160">160</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
<a id="aad3e63ccd707266363d6feeca754a370" name="aad3e63ccd707266363d6feeca754a370"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad3e63ccd707266363d6feeca754a370">&#9670;&nbsp;</a></span>rs_scoop_advance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rs_scoop_advance </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Advance the input cursor forward <code>len</code> bytes. </p>
<p >This is used after doing readahead, when you decide you want to keep it. <code>len</code> must be no more than the amount of available data, so you can't cheat.</p>
<p >So when creating a delta, we require one block of readahead. But after examining that block, we might decide to advance over all of it (if there is a match), or just one byte (if not). </p>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00117">117</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
<a id="a026b9505478d48f4b9b05fea46c166e1" name="a026b9505478d48f4b9b05fea46c166e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a026b9505478d48f4b9b05fea46c166e1">&#9670;&nbsp;</a></span>rs_scoop_readahead()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a> rs_scoop_readahead </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read from scoop without advancing. </p>
<p >Ask for LEN bytes of input from the stream. If that much data is available, then return a pointer to it in PTR, advance the stream input pointer over the data, and return RS_DONE. If there's not enough data, then accept whatever is there into a buffer, advance over it, and return RS_BLOCKED.</p>
<p >The data is not actually removed from the input, so this function lets you do readahead. If you want to keep any of the data, you should also call <a class="el" href="scoop_8c.html#aad3e63ccd707266363d6feeca754a370" title="Advance the input cursor forward len bytes.">rs_scoop_advance()</a> to skip over it. </p>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00148">148</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
<a id="a9eb894edc12cd2972a1eb020bdc80725" name="a9eb894edc12cd2972a1eb020bdc80725"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9eb894edc12cd2972a1eb020bdc80725">&#9670;&nbsp;</a></span>rs_scoop_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a> rs_scoop_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read LEN bytes if possible, and remove them from the input scoop. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*job</td><td>An rs_job_t pointer to the job instance.</td></tr>
    <tr><td class="paramname">len</td><td>The length of the data in the ptr buffer.</td></tr>
    <tr><td class="paramname">**ptr</td><td>will be updated to point to a read-only buffer holding the data, if enough is available.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>RS_DONE if there was enough data, RS_BLOCKED if there was not enough data yet, or RS_INPUT_ENDED if there was not enough data and at EOF. </dd></dl>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00192">192</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
<a id="af9c1b8a80bbed23d9409559fa101496b" name="af9c1b8a80bbed23d9409559fa101496b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9c1b8a80bbed23d9409559fa101496b">&#9670;&nbsp;</a></span>rs_scoop_read_rest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a> rs_scoop_read_rest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read whatever data remains in the input stream. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*job</td><td>The rs_job_t instance the job instance.</td></tr>
    <tr><td class="paramname">*len</td><td>will be updated to the length of the available data.</td></tr>
    <tr><td class="paramname">**ptr</td><td>will point at the available data.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>RS_DONE if there was data, RS_INPUT_ENDED if there was no data and at EOF, RS_BLOCKED if there was no data and not at EOF. </dd></dl>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00212">212</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
<a id="a28ab45a981e0a32d504f9eb3c6155798" name="a28ab45a981e0a32d504f9eb3c6155798"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28ab45a981e0a32d504f9eb3c6155798">&#9670;&nbsp;</a></span>rs_scoop_avail()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t rs_scoop_avail </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="scoop_8h_source.html#l00094">94</a> of file <a class="el" href="scoop_8h_source.html">scoop.h</a>.</p>

</div>
</div>
<a id="a6eb10b8ed1aa7f16ddf66e2e1051ff85" name="a6eb10b8ed1aa7f16ddf66e2e1051ff85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6eb10b8ed1aa7f16ddf66e2e1051ff85">&#9670;&nbsp;</a></span>rs_scoop_eof()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool rs_scoop_eof </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Test if the scoop has reached eof. </p>

<p class="definition">Definition at line <a class="el" href="scoop_8h_source.html#l00100">100</a> of file <a class="el" href="scoop_8h_source.html">scoop.h</a>.</p>

</div>
</div>
<a id="ac67ce8e051fbfa5b65cbaf09f42a5b15" name="ac67ce8e051fbfa5b65cbaf09f42a5b15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac67ce8e051fbfa5b65cbaf09f42a5b15">&#9670;&nbsp;</a></span>rs_scoop_buf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * rs_scoop_buf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get a pointer to the next input in the scoop. </p>

<p class="definition">Definition at line <a class="el" href="scoop_8h_source.html#l00106">106</a> of file <a class="el" href="scoop_8h_source.html">scoop.h</a>.</p>

</div>
</div>
<a id="aee362de570b50eb6b6c4e9d8f0251208" name="aee362de570b50eb6b6c4e9d8f0251208"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee362de570b50eb6b6c4e9d8f0251208">&#9670;&nbsp;</a></span>rs_scoop_len()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t rs_scoop_len </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the contiguous length of the next input in the scoop. </p>

<p class="definition">Definition at line <a class="el" href="scoop_8h_source.html#l00113">113</a> of file <a class="el" href="scoop_8h_source.html">scoop.h</a>.</p>

</div>
</div>
<a id="a0e7de2ad29ba6881e1320c5f45e7b023" name="a0e7de2ad29ba6881e1320c5f45e7b023"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e7de2ad29ba6881e1320c5f45e7b023">&#9670;&nbsp;</a></span>rs_scoop_getbuf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * rs_scoop_getbuf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the next contiguous buffer of data available in the scoop. </p>
<p >This will return a pointer to the data and reduce len to the amount of contiguous data available at that position.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*job</td><td>- the job instance to use.</td></tr>
    <tr><td class="paramname">*len</td><td>- the amount of data desired, updated to the amount available.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the data. </dd></dl>

<p class="definition">Definition at line <a class="el" href="scoop_8h_source.html#l00128">128</a> of file <a class="el" href="scoop_8h_source.html">scoop.h</a>.</p>

</div>
</div>
<a id="ab0599c9d3737912cd1fc5e31bc8664c1" name="ab0599c9d3737912cd1fc5e31bc8664c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0599c9d3737912cd1fc5e31bc8664c1">&#9670;&nbsp;</a></span>rs_scoop_iterbuf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * rs_scoop_iterbuf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>ilen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Iterate through and consume contiguous data buffers in the scoop. </p>
<p >Example: </p><div class="fragment"><div class="line"><span class="keywordtype">size_t</span> len=rs_scoop_avail(job);</div>
<div class="line"><span class="keywordtype">size_t</span> ilen;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (buf = <a class="code hl_function" href="scoop_8h.html#ab0599c9d3737912cd1fc5e31bc8664c1">rs_scoop_iterbuf</a>(job, &amp;len, &amp;ilen); ilen &gt; 0;</div>
<div class="line">     buf = <a class="code hl_function" href="scoop_8h.html#aeee826905a895126adac975f2c3cfc78">rs_scoop_nextbuf</a>(job, &amp;len, &amp;ilen))</div>
<div class="line">  ilen = fwrite(buf, ilen, 1, f);</div>
<div class="ttc" id="ascoop_8h_html_ab0599c9d3737912cd1fc5e31bc8664c1"><div class="ttname"><a href="scoop_8h.html#ab0599c9d3737912cd1fc5e31bc8664c1">rs_scoop_iterbuf</a></div><div class="ttdeci">static void * rs_scoop_iterbuf(rs_job_t *job, size_t *len, size_t *ilen)</div><div class="ttdoc">Iterate through and consume contiguous data buffers in the scoop.</div><div class="ttdef"><b>Definition:</b> <a href="scoop_8h_source.html#l00165">scoop.h:165</a></div></div>
<div class="ttc" id="ascoop_8h_html_aeee826905a895126adac975f2c3cfc78"><div class="ttname"><a href="scoop_8h.html#aeee826905a895126adac975f2c3cfc78">rs_scoop_nextbuf</a></div><div class="ttdeci">static void * rs_scoop_nextbuf(rs_job_t *job, size_t *len, size_t *ilen)</div><div class="ttdoc">Get the next iteration of contiguous data buffers from the scoop.</div><div class="ttdef"><b>Definition:</b> <a href="scoop_8h_source.html#l00175">scoop.h:175</a></div></div>
</div><!-- fragment --><p >At each iteration buf and ilen are the data and its length for the current iteration, and len is the remaining data to iterate through including the current iteration. During an iteration you can change ilen to indicate only part of the buffer was processed and the next iteration will take this into account. Setting ilen = 0 to indicate blocking or errors will terminate iteration.</p>
<p >At the end of iteration buf will point at the next location in the scoop after the iterated data, len and ilen will be zero, or the remaining data and last ilen if iteration was terminated by setting ilen = 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*job</td><td>- the job instance to use.</td></tr>
    <tr><td class="paramname">*len</td><td>- the size_t amount of data to iterate over.</td></tr>
    <tr><td class="paramname">*ilen</td><td>- the size_t amount of data in the current iteration.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to data in the current iteration. </dd></dl>

<p class="definition">Definition at line <a class="el" href="scoop_8h_source.html#l00165">165</a> of file <a class="el" href="scoop_8h_source.html">scoop.h</a>.</p>

</div>
</div>
<a id="aeee826905a895126adac975f2c3cfc78" name="aeee826905a895126adac975f2c3cfc78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeee826905a895126adac975f2c3cfc78">&#9670;&nbsp;</a></span>rs_scoop_nextbuf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * rs_scoop_nextbuf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>ilen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the next iteration of contiguous data buffers from the scoop. </p>
<p >This advances the scoop for the previous iteration, and gets the next iteration. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="scoop_8h.html#ab0599c9d3737912cd1fc5e31bc8664c1" title="Iterate through and consume contiguous data buffers in the scoop.">rs_scoop_iterbuf</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="scoop_8h_source.html#l00175">175</a> of file <a class="el" href="scoop_8h_source.html">scoop.h</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<!-- ad -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- librsync -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3547096055927362"
     data-ad-slot="8322976738"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<!-- analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-71109100-1', 'auto');
  ga('send', 'pageview');
</script>
<hr class="footer"/><address class="footer"><small>
Generated on Sun Feb 19 2023 16:26:51 for librsync by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.4
</small></address>
</body>
</html>
