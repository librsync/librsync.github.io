<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>librsync: scoop.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <!-- ad -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- librsync -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3547096055927362"
         data-ad-slot="8322976738"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">librsync
   &#160;<span id="projectnumber">2.3.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">scoop.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This file deals with readahead from caller-supplied buffers.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
Include dependency graph for scoop.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="scoop_8c__incl.svg" width="1142" height="411"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="scoop_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8ae53f7e4fef0f68a2308d26767ddbdc"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8c.html#a8ae53f7e4fef0f68a2308d26767ddbdc">rs_scoop_input</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t len)</td></tr>
<tr class="memdesc:a8ae53f7e4fef0f68a2308d26767ddbdc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to accept a from the input buffer to get LEN bytes in the scoop.  <a href="scoop_8c.html#a8ae53f7e4fef0f68a2308d26767ddbdc">More...</a><br /></td></tr>
<tr class="separator:a8ae53f7e4fef0f68a2308d26767ddbdc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad3e63ccd707266363d6feeca754a370"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8c.html#aad3e63ccd707266363d6feeca754a370">rs_scoop_advance</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t len)</td></tr>
<tr class="memdesc:aad3e63ccd707266363d6feeca754a370"><td class="mdescLeft">&#160;</td><td class="mdescRight">Advance the input cursor forward <code>len</code> bytes.  <a href="scoop_8c.html#aad3e63ccd707266363d6feeca754a370">More...</a><br /></td></tr>
<tr class="separator:aad3e63ccd707266363d6feeca754a370"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a026b9505478d48f4b9b05fea46c166e1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8c.html#a026b9505478d48f4b9b05fea46c166e1">rs_scoop_readahead</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t len, void **ptr)</td></tr>
<tr class="memdesc:a026b9505478d48f4b9b05fea46c166e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read from scoop without advancing.  <a href="scoop_8c.html#a026b9505478d48f4b9b05fea46c166e1">More...</a><br /></td></tr>
<tr class="separator:a026b9505478d48f4b9b05fea46c166e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9eb894edc12cd2972a1eb020bdc80725"><td class="memItemLeft" align="right" valign="top"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8c.html#a9eb894edc12cd2972a1eb020bdc80725">rs_scoop_read</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t len, void **ptr)</td></tr>
<tr class="memdesc:a9eb894edc12cd2972a1eb020bdc80725"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read LEN bytes if possible, and remove them from the input scoop.  <a href="scoop_8c.html#a9eb894edc12cd2972a1eb020bdc80725">More...</a><br /></td></tr>
<tr class="separator:a9eb894edc12cd2972a1eb020bdc80725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9c1b8a80bbed23d9409559fa101496b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="scoop_8c.html#af9c1b8a80bbed23d9409559fa101496b">rs_scoop_read_rest</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, size_t *len, void **ptr)</td></tr>
<tr class="memdesc:af9c1b8a80bbed23d9409559fa101496b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read whatever data remains in the input stream.  <a href="scoop_8c.html#af9c1b8a80bbed23d9409559fa101496b">More...</a><br /></td></tr>
<tr class="separator:af9c1b8a80bbed23d9409559fa101496b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >This file deals with readahead from caller-supplied buffers. </p>
<p >Many functions require a certain minimum amount of contiguous input data to do their processing. For example, to calculate a strong checksum of a block we need at least a block of input.</p>
<p >Since we put the buffers completely under the control of the caller, we can't count on ever getting this much data all in one go. We can't simply wait, because the caller might have a smaller buffer than we require and so we'll never get it.</p>
<p >Stream input data is used directly if there is sufficient data to satisfy the readhead requests, otherwise it is copied and accumulated into an internal buffer until there is enough. This means for large input buffers we can leave a "tail" of unprocessed data in the input buffer, and only consume all the data if it was too small and start accumulating into the internal buffer. Provided the input buffers always have enough data we avoid copying into the internal buffer at all.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000014">Todo:</a></b></dt><dd>We probably know a maximum amount of data that can be scooped up, so we could just avoid dynamic allocation. However that can't be fixed at compile time, because when generating a delta it needs to be large enough to hold one full block. Perhaps we can set it up when the job is allocated? It would be kind of nice to not do any memory allocation after startup, as bzlib does this. </dd></dl>

<p class="definition">Definition in file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a8ae53f7e4fef0f68a2308d26767ddbdc" name="a8ae53f7e4fef0f68a2308d26767ddbdc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ae53f7e4fef0f68a2308d26767ddbdc">&#9670;&nbsp;</a></span>rs_scoop_input()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void rs_scoop_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Try to accept a from the input buffer to get LEN bytes in the scoop. </p>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00065">65</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
<a id="aad3e63ccd707266363d6feeca754a370" name="aad3e63ccd707266363d6feeca754a370"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad3e63ccd707266363d6feeca754a370">&#9670;&nbsp;</a></span>rs_scoop_advance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rs_scoop_advance </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Advance the input cursor forward <code>len</code> bytes. </p>
<p >This is used after doing readahead, when you decide you want to keep it. <code>len</code> must be no more than the amount of available data, so you can't cheat.</p>
<p >So when creating a delta, we require one block of readahead. But after examining that block, we might decide to advance over all of it (if there is a match), or just one byte (if not). </p>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00116">116</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
<a id="a026b9505478d48f4b9b05fea46c166e1" name="a026b9505478d48f4b9b05fea46c166e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a026b9505478d48f4b9b05fea46c166e1">&#9670;&nbsp;</a></span>rs_scoop_readahead()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a> rs_scoop_readahead </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read from scoop without advancing. </p>
<p >Ask for LEN bytes of input from the stream. If that much data is available, then return a pointer to it in PTR, advance the stream input pointer over the data, and return RS_DONE. If there's not enough data, then accept whatever is there into a buffer, advance over it, and return RS_BLOCKED.</p>
<p >The data is not actually removed from the input, so this function lets you do readahead. If you want to keep any of the data, you should also call <a class="el" href="scoop_8c.html#aad3e63ccd707266363d6feeca754a370" title="Advance the input cursor forward len bytes.">rs_scoop_advance()</a> to skip over it. </p>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00147">147</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
<a id="a9eb894edc12cd2972a1eb020bdc80725" name="a9eb894edc12cd2972a1eb020bdc80725"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9eb894edc12cd2972a1eb020bdc80725">&#9670;&nbsp;</a></span>rs_scoop_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a> rs_scoop_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read LEN bytes if possible, and remove them from the input scoop. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*job</td><td>An rs_job_t pointer to the job instance.</td></tr>
    <tr><td class="paramname">len</td><td>The length of the data in the ptr buffer.</td></tr>
    <tr><td class="paramname">**ptr</td><td>will be updated to point to a read-only buffer holding the data, if enough is available.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>RS_DONE if there was enough data, RS_BLOCKED if there was not enough data yet, or RS_INPUT_ENDED if there was not enough data and at EOF. </dd></dl>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00191">191</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
<a id="af9c1b8a80bbed23d9409559fa101496b" name="af9c1b8a80bbed23d9409559fa101496b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9c1b8a80bbed23d9409559fa101496b">&#9670;&nbsp;</a></span>rs_scoop_read_rest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="librsync_8h.html#a7feb858ceba3b8f3cf048d49be108253">rs_result</a> rs_scoop_read_rest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read whatever data remains in the input stream. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*job</td><td>The rs_job_t instance the job instance.</td></tr>
    <tr><td class="paramname">*len</td><td>will be updated to the length of the available data.</td></tr>
    <tr><td class="paramname">**ptr</td><td>will point at the available data.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>RS_DONE if there was data, RS_INPUT_ENDED if there was no data and at EOF, RS_BLOCKED if there was no data and not at EOF. </dd></dl>

<p class="definition">Definition at line <a class="el" href="scoop_8c_source.html#l00211">211</a> of file <a class="el" href="scoop_8c_source.html">scoop.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<!-- ad -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- librsync -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3547096055927362"
     data-ad-slot="8322976738"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<!-- analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-71109100-1', 'auto');
  ga('send', 'pageview');
</script>
<hr class="footer"/><address class="footer"><small>
Generated on Thu Feb 16 2023 19:31:11 for librsync by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.4
</small></address>
</body>
</html>
