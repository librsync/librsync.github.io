<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<title>librsync: tube.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <!-- ad -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- librsync -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3547096055927362"
         data-ad-slot="8322976738"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">librsync
   &#160;<span id="projectnumber">2.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tube.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="tube_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab55e376728666a0f6138efe348826253"><td class="memItemLeft" align="right" valign="top"><a id="ab55e376728666a0f6138efe348826253"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><b>rs_tube_catchup_write</b> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="separator:ab55e376728666a0f6138efe348826253"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad10806e9437c7424409af983bc714a0a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tube_8c.html#ad10806e9437c7424409af983bc714a0a">rs_tube_copy_from_scoop</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="memdesc:ad10806e9437c7424409af983bc714a0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute a copy command, taking data from the scoop.  <a href="tube_8c.html#ad10806e9437c7424409af983bc714a0a">More...</a><br /></td></tr>
<tr class="separator:ad10806e9437c7424409af983bc714a0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d0f841e07770b6d64e53fce19056a6a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tube_8c.html#a3d0f841e07770b6d64e53fce19056a6a">rs_tube_catchup_copy</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="memdesc:a3d0f841e07770b6d64e53fce19056a6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Catch up on an outstanding copy command.  <a href="tube_8c.html#a3d0f841e07770b6d64e53fce19056a6a">More...</a><br /></td></tr>
<tr class="separator:a3d0f841e07770b6d64e53fce19056a6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54dc3433c7346a3a4960908074c0a122"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tube_8c.html#a54dc3433c7346a3a4960908074c0a122">rs_tube_catchup</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job)</td></tr>
<tr class="memdesc:a54dc3433c7346a3a4960908074c0a122"><td class="mdescLeft">&#160;</td><td class="mdescRight">Put whatever will fit from the tube into the output of the stream.  <a href="tube_8c.html#a54dc3433c7346a3a4960908074c0a122">More...</a><br /></td></tr>
<tr class="separator:a54dc3433c7346a3a4960908074c0a122"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa78a2f17f45a022ec0f93a50c3f142d"><td class="memItemLeft" align="right" valign="top"><a id="afa78a2f17f45a022ec0f93a50c3f142d"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>rs_tube_is_idle</b> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> const *job)</td></tr>
<tr class="separator:afa78a2f17f45a022ec0f93a50c3f142d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35e5fd0a62b2311eb2b0ccb71aefd01a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tube_8c.html#a35e5fd0a62b2311eb2b0ccb71aefd01a">rs_tube_copy</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, int len)</td></tr>
<tr class="memdesc:a35e5fd0a62b2311eb2b0ccb71aefd01a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue up a request to copy through <code>len</code> bytes from the input to the output of the stream.  <a href="tube_8c.html#a35e5fd0a62b2311eb2b0ccb71aefd01a">More...</a><br /></td></tr>
<tr class="separator:a35e5fd0a62b2311eb2b0ccb71aefd01a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15809106e8f91386fb19f3934f73b993"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tube_8c.html#a15809106e8f91386fb19f3934f73b993">rs_tube_write</a> (<a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *job, const void *buf, size_t len)</td></tr>
<tr class="memdesc:a15809106e8f91386fb19f3934f73b993"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push some data into the tube for storage.  <a href="tube_8c.html#a15809106e8f91386fb19f3934f73b993">More...</a><br /></td></tr>
<tr class="separator:a15809106e8f91386fb19f3934f73b993"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A somewhat elastic but fairly small buffer for data passing through a stream.</p>
<p>In most cases the iter can adjust to send just as much data will fit. In some cases that would be too complicated, because it has to transmit an integer or something similar. So in that case we stick whatever won't fit into a small buffer.</p>
<p>A tube can contain some literal data to go out (typically command bytes), and also an instruction to copy data from the stream's input or from some other location. Both literal data and a copy command can be queued at the same time, but only in that order and at most one of each.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000021">Todo:</a></b></dt><dd>As an optimization, write it directly to the stream if possible. But for simplicity don't do that yet.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000022">Todo:</a></b></dt><dd>I think our current copy code will lock up if the application only ever calls us with either input or output buffers, and not both. So I guess in that case we might need to copy into some temporary buffer space, and then back out again later. </dd></dl>

<p class="definition">Definition in file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad10806e9437c7424409af983bc714a0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad10806e9437c7424409af983bc714a0a">&#9670;&nbsp;</a></span>rs_tube_copy_from_scoop()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void rs_tube_copy_from_scoop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Execute a copy command, taking data from the scoop. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="tube_8c.html#a3d0f841e07770b6d64e53fce19056a6a" title="Catch up on an outstanding copy command.">rs_tube_catchup_copy()</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00089">89</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
<a id="a3d0f841e07770b6d64e53fce19056a6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d0f841e07770b6d64e53fce19056a6a">&#9670;&nbsp;</a></span>rs_tube_catchup_copy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void rs_tube_catchup_copy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Catch up on an outstanding copy command. </p>
<p>Takes data from the scoop, and the input (in that order), and writes as much as will fit to the output, up to the limit of the outstanding copy. </p>

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00114">114</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
<a id="a54dc3433c7346a3a4960908074c0a122"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54dc3433c7346a3a4960908074c0a122">&#9670;&nbsp;</a></span>rs_tube_catchup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rs_tube_catchup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Put whatever will fit from the tube into the output of the stream. </p>
<dl class="section return"><dt>Returns</dt><dd>RS_DONE if the tube is now empty and ready to accept another command, RS_BLOCKED if there is still stuff waiting to go out. </dd></dl>

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00136">136</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
<a id="a35e5fd0a62b2311eb2b0ccb71aefd01a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35e5fd0a62b2311eb2b0ccb71aefd01a">&#9670;&nbsp;</a></span>rs_tube_copy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rs_tube_copy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue up a request to copy through <code>len</code> bytes from the input to the output of the stream. </p>
<p>The data is copied from the scoop (if there is anything there) or from the input, on the next call to <a class="el" href="tube_8c.html#a15809106e8f91386fb19f3934f73b993" title="Push some data into the tube for storage.">rs_tube_write()</a>.</p>
<p>We can only accept this request if there is no copy command already pending.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000023">Todo:</a></b></dt><dd>Try to do the copy immediately, and return a result. Then, people can try to continue if possible. Is this really required? Callers can just go out and back in again after flushing the tube. </dd></dl>

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00178">178</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
<a id="a15809106e8f91386fb19f3934f73b993"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15809106e8f91386fb19f3934f73b993">&#9670;&nbsp;</a></span>rs_tube_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rs_tube_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librsync_8h.html#add6622b38e3fa557301a190876d5ed4a">rs_job_t</a> *&#160;</td>
          <td class="paramname"><em>job</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Push some data into the tube for storage. </p>
<p>The tube's never supposed to get very big, so this will just pop loudly if you do that.</p>
<p>We can't accept write data if there's already a copy command in the tube, because the write data comes out first. </p>

<p class="definition">Definition at line <a class="el" href="tube_8c_source.html#l00192">192</a> of file <a class="el" href="tube_8c_source.html">tube.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<!-- ad -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- librsync -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3547096055927362"
     data-ad-slot="8322976738"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<!-- analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-71109100-1', 'auto');
  ga('send', 'pageview');
</script>
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 12 2020 15:46:02 for librsync by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
