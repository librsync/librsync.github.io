<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<title>librsync: CONTRIBUTING</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <!-- ad -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- librsync -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3547096055927362"
         data-ad-slot="8322976738"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">librsync
   &#160;<span id="projectnumber">2.3.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">CONTRIBUTING </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Instructions and conventions for people wanting to work on librsync. Please consider these guidelines even if you're doing your own fork.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Requirements</h1>
<p >There are a bunch of tools and libraries that are useful for development or that librsync depends on. In addition to the standard cmake/gcc/make/etc C development tools, the following packages are recommended;</p>
<ul>
<li>libpopt-dev - the cmdline argument parsing library used by rdiff. If this is not available rdiff cannot be compiled, and only the librsync library will be compiled.</li>
<li>libb2-dev - blake2 hash library librsync can use if <code>USE_LIBB2</code> is set to <code>ON</code> in cmake. If this is not avalable librsync will use its included copy of blake2 (which may be older... or newer).</li>
<li>doxygen - documentation generator used to generate html documentation. If installed <code>make doc</code> can be run to generate all the docs.</li>
<li>graphviz - graph generator used by doxygen for generating diagrams. If not installed doxygen will not generate any diagrams.</li>
<li>indent - code reformatter for tidying code. If installed all the code can be tidied with <code>make tidy</code>.</li>
<li><a href="https://github.com/dbaarda/tidyc">tidyc</a> - extension wrapper for indent that includes better formatting of doxygen comments. If installed code and comments can be tidied with <code>make tidyc</code>.</li>
<li>clang-tidy - code lint checker for potential problems. If installed the code can be checked with <code>make clang-tidy</code>.</li>
<li>iwyu - <code>#include</code> checker and fixer. If installed includes can be checked with <code>make iwyu</code>, and automatically fixed with <code>make iwyu-fix</code>. Note on some platforms this package is <a href="https://bugs.launchpad.net/ubuntu/+source/iwyu/+bug/1769334">missing a dependency</a> and also needs <code>libclang-common-9-dev</code> to be installed.</li>
</ul>
<p >These can all be installed on Debian/Ubuntu systems by running;</p>
<div class="fragment"><div class="line">$ apt-get update</div>
<div class="line">$ apt-get install libpopt-dev libb2-dev doxygen graphviz indent clang-tidy iwyu</div>
<div class="line">$ git clone https://github.com/dbaarda/tidyc.git</div>
<div class="line">$ cp tidyc/tidyc ~/bin</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2"></a>
Windows</h2>
<p >Not all the recommended packages are easily available on windows. <a href="https://cygwin.com/">Cygwin</a> and <a href="http://msys2.org/">MSYS2</a> provide a development environment similar to Linux. Some packages can also be found on <a href="https://chocolatey.org/">Chocolatey</a>. For native development using standard MSVC tools, libpopt can be found on <a href="https://vcpkg.io/">vcpkg</a> and installed by running;</p>
<div class="fragment"><div class="line">$ vcpkg update</div>
<div class="line">$ vcpkg --triplet x64-windows install libpopt</div>
</div><!-- fragment --><p >For cmake to find the installed libpopt you need to add <code>-D CMAKE_TOOLCHAIN_FILE=C:/vcpkg/scripts/buildsystems/vcpkg.cmake</code> to the cmake cmdline. This configures cmake to correctly search the vcpkg install locations to find libraries.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
MacOS</h2>
<p >MacOS is generally more similar to Linux than Windows, and several packages are available on homebrew. The libpopt library can be installed by running;</p>
<div class="fragment"><div class="line">$ brew update</div>
<div class="line">$ brew install popt</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Building</h1>
<p >The minimal instructions to fetch, configure, compile, and test everything using a in-place default Debug build with trace enabled using the internal blake2 implementation is;</p>
<div class="fragment"><div class="line">$ git clone https://github.com/librsync/librsync.git</div>
<div class="line">$ cd librsync</div>
<div class="line">$ cmake .</div>
<div class="line">$ make check</div>
</div><!-- fragment --><p >For cmake, <code>-B</code> can be used to select a separate build directory, and <code>-G</code> can select a different make system. Also the following settings can be changed with <code>-D &lt;setting&gt;=&lt;value&gt;</code> arguments when generating the project with cmake;</p>
<ul>
<li>CMAKE_BUILD_TYPE=(Debug|Release|MinSizeRel|RelWithDebInfo) - the build type to use, which selects compiler options. The default is <code>Debug</code>.</li>
<li>CMAKE_C_COMPILER=(cc|gcc|clang|...) - The compiler to use. The default is to auto-detect the available compiler on the platform.</li>
<li>BUILD_RDIFF=(ON|OFF) - Whether to build and test the rdiff executable. Defaults to ON if libpopt is available.</li>
<li>BUILD_SHARED_LIBS=(ON|OFF) - Whether to build dynamic libraries or use static linking. Defaults to ON.</li>
<li>ENABLE_TRACE=(ON|OFF) - Whether to enable trace output in the library and for rdiff using <code>-v</code>. Trace output can help with debugging but its a little faster with ENABLE_TRACE=OFF. Defaults to ON for Debug builds, and OFF for others.</li>
<li>USE_LIBB2=(ON|OFF) - Whether to use libb2 instead of the included blake2 implementation. Defaults to OFF.</li>
</ul>
<p >So for a Release build in a separate directory using Ninja, clang, static linking, and libb2 with trace enabled, do this instead;</p>
<div class="fragment"><div class="line">$ cmake -B build -G Ninja</div>
<div class="line">  -D CMAKE_C_COMPILER=clang \</div>
<div class="line">  -D CMAKE_BUILD_TYPE=Release \</div>
<div class="line">  -D BUILD_SHARED_LIBS=OFF \</div>
<div class="line">  -D USE_LIBB2=ON \</div>
<div class="line">  -D ENABLE_TRACE=ON</div>
<div class="line">$ cmake --build build --config Release --target check</div>
</div><!-- fragment --><p >You can also use ccmake or cmake-gui to interactively configure and generate into a separate build directory with;</p>
<div class="fragment"><div class="line">$ ccmake -B build</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5"></a>
Coding</h1>
<p >The prefered style for code is equivalent to using GNU indent with the following arguments;</p>
<div class="fragment"><div class="line">$ indent -linux -nut -i4 -ppi2 -l80 -lc80 -fc1 -sob -T FILE -T Rollsum -T rs_result</div>
</div><!-- fragment --><p >The preferred style for non-docbook comments are as follows;</p>
<div class="fragment"><div class="line">                     <span class="comment">/*=</span></div>
<div class="line"><span class="comment">                      | A short poem that</span></div>
<div class="line"><span class="comment">                      | shall never ever be</span></div>
<div class="line"><span class="comment">                      | reformated or reindented</span></div>
<div class="line"><span class="comment">                      */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Single line comment indented to match code indenting. */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Blank line delimited paragraph multi-line comments.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   Without leading stars, or blank line comment delimiters. */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> a;                      <span class="comment">/* code line comments */</span></div>
</div><!-- fragment --><p >The preferred style for docbook comments is javadoc with autobrief as follows;</p>
<div class="fragment"><div class="line"><span class="comment">/** /file file.c</span></div>
<div class="line"><span class="comment">  * Brief summary paragraph.</span></div>
<div class="line"><span class="comment">  *</span></div>
<div class="line"><span class="comment">  * With blank line paragraph delimiters and leading stars.</span></div>
<div class="line"><span class="comment">  *</span></div>
<div class="line"><span class="comment">  * /param foo parameter descriptions...</span></div>
<div class="line"><span class="comment">  *</span></div>
<div class="line"><span class="comment">  * /param bar ...in separate blank-line delimited paragraphs.</span></div>
<div class="line"><span class="comment">  *</span></div>
<div class="line"><span class="comment">  * Example:/code</span></div>
<div class="line"><span class="comment">  *  code blocks that will never be reformated.</span></div>
<div class="line"><span class="comment">  * /endcode</span></div>
<div class="line"><span class="comment">  *</span></div>
<div class="line"><span class="comment">  * Without blank-line comment delimiters. */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> a;                      <span class="comment">/**&lt; brief attribute description */</span></div>
<div class="line">    <span class="keywordtype">int</span> b;                      <span class="comment">/**&lt; multiline attribute description</span></div>
<div class="line"><span class="comment">                                 *</span></div>
<div class="line"><span class="comment">                                 * With blank line delimited paragraphs.*/</span></div>
</div><!-- fragment --><p >There is a <code>make tidy</code> target that will use GNU indent to reformat all code and non-docbook comments, doing some pre/post processing with sed to handle some corner cases indent doesn't handle well.</p>
<p >There is a <code>make tidyc</code> target that will reformat all code and comments with <a href="https://github.com/dbaarda/tidyc">tidyc</a>. This will also correctly reformat all docbook comments, equivalent to running tidyc with the following arguments;</p>
<div class="fragment"><div class="line">$ tidyc -R -C -l80 -T FILE -T Rollsum -T rs_result</div>
</div><!-- fragment --><p >There is <code>make clang-tidy</code> and <code>make iwyu</code> targets for checking for coding errors and incorrect <code>#include</code> statements. Note that the iwyu check gets confused by and will emit warnings about <code><a class="el" href="fileutil_8c_source.html">fileutil.c</a></code> which has extra conditional includes necessary to find working functions on various platforms. Other than <code><a class="el" href="fileutil_8c_source.html">fileutil.c</a></code> both checks should be clean.</p>
<p >If iwyu finds problems, <code>make ifwu-fix</code> can be run to automatically fix them, followed by <code>make tidyc</code> to reformat the result to our preferred style. Note that this doesn't always produce an ideal result and may require manual intervention.</p>
<p >Please try to update docs and tests in parallel with code changes.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Testing</h1>
<p >Using <code>make check</code> will compile and run all tests. Additional code correctness checks can be run with <code>make clang-tidy</code> and <code>make iwyu</code>.</p>
<p >Note that <code>assert()</code> is used extensively within the code for verifying the correctness of internal operations using a roughly design-by-contract approach. These are only enabled for Debug builds, so testing with a Debug build will give a better chance of identifying problems during development. Once you are confident the code is correct, a Release build will turn these off giving faster execution.</p>
<p >There are also GitHub Actions configured for the librsync project to configure, build, test, and lint everything on a variety of different platforms with a variety of different settings. These are run against any pull request or commit, and are a good way to check things are not broken for other platforms.</p>
<p >Test results for builds of public github branches are at <a href="https://github.com/librsync/librsync/actions">https://github.com/librsync/librsync/actions</a>.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Documenting</h1>
<p ><a class="el" href="md_NEWS.html">NEWS.md</a> contains a list of user-visible changes in the library between release versions. This includes changes to the way it's packaged, bug fixes, portability notes, changes to the API, and so on. Add and update items under a "Changes in X.Y.Z" heading at the top of the file. Do this as you go along, so that we don't need to work out what happened when it's time for a release.</p>
<p ><a class="el" href="md_TODO.html">TODO.md</a> contains a list of ideas and proposals for the future. Ideally entries should be formated in a way that can be just moved into <a class="el" href="md_NEWS.html">NEWS.md</a> when they are done. Regularly check to see if there is anything that needs removing or updating.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Submitting</h1>
<p >Fixes or improvements in pull requests are welcome. Please:</p>
<ul>
<li>[ ] Send small PRs that address one issues each.</li>
<li>[ ] Update <code>NEWS.md</code> to say what you changed.</li>
<li>[ ] Add a test as a self-contained C file in <code>tests/</code> that passes or fails, and is hooked into <code>CMakeLists.txt</code>.</li>
<li>[ ] Keep the code style consistent with what's already there, especially in keeping symbols with an <code>rs_</code> prefix.</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
Releasing</h1>
<p >If you are making a new tarball release of librsync, follow this checklist:</p>
<ul>
<li>Make a "Release vx.x.x" pull request containing updates ready for the release including;<ul>
<li>Review the changes included and decide if the release should be a major (non-backwards compatible change), minor (backwards compatible change), or micro (bugfix only change) version number change to get the new "X.Y.Z" version number.</li>
<li>NEWS.md - make sure the top "Changes in X.Y.Z" is correct, and the date is correct. Make sure the changes since the last release are documented.</li>
<li>TODO.md - check if anything needs to be removed or updated.</li>
<li><code>CMakeLists.txt</code> - version is correct.</li>
<li><code>librsync.spec</code> - make sure version and URL are right.</li>
</ul>
</li>
<li>Run <code>make all doc check</code> in a clean checkout of the release pull request branch. Also check the GitHub Actions <a href="https://github.com/librsync/librsync/actions">check and lint status</a> of the last commit on github. If it all looks good merge the release pull request on github.</li>
<li>Draft a new release on github, typing in the release details including an overview, included changes, and known issues. The overview should give an indication of the magnitude of the changes and their impact, and the relative urgency to upgrade. The included changes should come from the NEWS.md for the release. It's probably easiest to copy and edit the previous release.</li>
<li>After creating the release, download the <code>Source code (tar.gz)</code> release asset. Go to "Actions", find the workflow run for the "Check" corresponding to the merge of the release pull request, and download the <code>install results windows-latest Release</code> artifact renamed to <code>librsync-win64-X.Y.Z.zip</code>. Edit the release, and upload the source code and windows artifacts. This ensures that the release includes a stable tarball (See <a href="https://github.com/librsync/librsync/issues/146">https://github.com/librsync/librsync/issues/146</a> for details) and win64 install.</li>
<li>Run <code>make doc</code> on a clean checkout of the new release tag and <code>cp -av html/*</code> into a <code>rm -Rf *</code> emptied checkout of librsync.github.io and check it in. This ensures it includes deletes of obsolete files as well as new and updated files. Push this to update the online docs.</li>
<li>Create and merge a "Prepare vX.Y.Z+1." pull request containing updates to prepare for the changes in the next release including;<ul>
<li>Bump the minor version in <code>CMakeLists.txt</code>.</li>
<li>Add a <code>NOT RELEASED YET</code> version entry in <code>NEWS.md</code></li>
<li>Bump the minor version and add a <code>changelog</code> entry in <code>librsync.spec</code>. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<!-- ad -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- librsync -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3547096055927362"
     data-ad-slot="8322976738"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<!-- analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-71109100-1', 'auto');
  ga('send', 'pageview');
</script>
<hr class="footer"/><address class="footer"><small>
Generated on Sun Feb 19 2023 16:26:51 for librsync by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.4
</small></address>
</body>
</html>
